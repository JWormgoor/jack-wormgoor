---
const year = new Date().getFullYear();

const metrics = [
  { key: "time", label: "Local time (UK)", value: "—", hint: "Updates automatically" },
  { key: "sun", label: "Sunrise / Sunset", value: "Loading…", hint: "sunrise-sunset.org API" },
  { key: "mode", label: "Theme", value: "Auto", hint: "Fades at sunrise/sunset" },
];

const projects = [
  { title: "Project title", desc: "One line about what it is. Keep it specific.", tag: "Build" },
  { title: "Project title", desc: "One line about what it is. Keep it specific.", tag: "Experiment" },
  { title: "Project title", desc: "One line about what it is. Keep it specific.", tag: "Software" },
];

const posts = [
  { title: "Post title", desc: "A short description of what the post is about.", tag: "Notes" },
  { title: "Post title", desc: "A short description of what the post is about.", tag: "Log" },
];
---

<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jack Wormgoor</title>
    <meta name="description" content="Jack Wormgoor — builder, experimenter, and problem solver." />

    <style>
      :root {
        --bg: #f4f1ea;
        --ink: #1f1a14;
        --muted: #6b6258;
        --card: #fbf9f4;
        --line: #e4ded4;
        --accent: #2a2119;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
        --radius: 18px;
      }

      html[data-theme="dark"] {
        --bg: #0f1115;
        --ink: #ede7dc;
        --muted: #b7ad9f;
        --card: #151821;
        --line: #2a2f3a;
        --accent: #ede7dc;
        --shadow: 0 12px 34px rgba(0, 0, 0, 0.35);
      }

      /* Golden hour theme */
      html[data-theme="golden"] {
        --bg: #1a140f;
        --ink: #fff1dd;
        --muted: #e3c7a3;
        --card: #241b14;
        --line: #3a2c21;
        --accent: #ffcc8a;
        --shadow: 0 12px 34px rgba(0, 0, 0, 0.45);
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        margin: 0;
        padding: 0;
      }

      body {
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
        background: var(--bg);
        color: var(--ink);
        line-height: 1.5;

        /* Smooth fade between themes */
        transition: background-color 900ms ease, color 900ms ease;
      }

      a {
        color: inherit;
        text-decoration: none;
      }
      a:hover {
        opacity: 0.92;
      }

      .wrap {
        max-width: 1020px;
        margin: 0 auto;
        padding: 28px 18px;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 18px;
        padding-top: 18px;
        padding-bottom: 10px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .mark {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: grid;
        place-items: center;
        background: var(--accent);
        color: var(--bg);
        font-weight: 800;
        letter-spacing: 0.04em;
        box-shadow: var(--shadow);

        transition: background-color 900ms ease, color 900ms ease, border-color 900ms ease,
          box-shadow 900ms ease;
      }

      .nav {
        display: flex;
        gap: 14px;
        flex-wrap: wrap;
      }
      .nav a {
        padding: 8px 10px;
        border-radius: 12px;
        transition: background-color 600ms ease;
      }
      .nav a:hover {
        background: rgba(127, 127, 127, 0.16);
      }

      .hero {
        padding: 28px 0 12px;
      }
      .kicker {
        margin: 0 0 10px;
        color: var(--muted);
        letter-spacing: 0.12em;
        text-transform: uppercase;
        font-size: 0.78rem;
      }
      h1 {
        margin: 0 0 10px;
        font-size: clamp(2rem, 4vw, 3rem);
        line-height: 1.08;
      }
      .lede {
        margin: 0;
        max-width: 68ch;
        color: var(--muted);
        font-size: 1.05rem;
      }

      .cta {
        display: flex;
        gap: 12px;
        margin: 18px 0 18px;
        flex-wrap: wrap;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 10px 14px;
        border-radius: 14px;
        background: var(--accent);
        color: var(--bg);
        border: 1px solid rgba(0, 0, 0, 0.06);
        box-shadow: var(--shadow);
        font-weight: 650;

        transition: background-color 900ms ease, color 900ms ease, border-color 900ms ease,
          box-shadow 900ms ease;
      }

      .btn.ghost {
        background: transparent;
        color: var(--ink);
        border: 1px solid var(--line);
        box-shadow: none;

        transition: background-color 900ms ease, color 900ms ease, border-color 900ms ease;
      }

      .metrics {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        margin-top: 10px;
      }

      .metric {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius);
        padding: 14px 14px 12px;
        box-shadow: var(--shadow);

        transition: background-color 900ms ease, color 900ms ease, border-color 900ms ease,
          box-shadow 900ms ease;
      }

      .metric .label {
        font-size: 0.8rem;
        color: var(--muted);
      }
      .metric .value {
        font-size: 1.25rem;
        font-weight: 800;
        margin-top: 4px;
      }
      .metric .hint {
        font-size: 0.82rem;
        color: var(--muted);
        margin-top: 6px;
      }

      .grid {
        display: grid;
        gap: 14px;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        margin-top: 18px;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius);
        padding: 18px;
        box-shadow: var(--shadow);

        transition: background-color 900ms ease, color 900ms ease, border-color 900ms ease,
          box-shadow 900ms ease;
      }

      .card h2 {
        margin: 0 0 8px;
        font-size: 1.2rem;
      }
      .card h3 {
        margin: 0 0 6px;
        font-size: 1.05rem;
      }

      .muted {
        color: var(--muted);
      }

      .list {
        margin: 10px 0 0;
        padding-left: 18px;
        color: var(--muted);
      }
      .list strong {
        color: var(--ink);
      }

      .section {
        margin-top: 26px;
      }
      .sectionhead {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        gap: 16px;
        flex-wrap: wrap;
      }
      .sectionhead h2 {
        margin: 0;
        font-size: 1.3rem;
      }

      .cards {
        display: grid;
        gap: 14px;
        margin-top: 12px;
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      .linkcard {
        transition: transform 120ms ease, box-shadow 120ms ease, background-color 900ms ease,
          border-color 900ms ease;
      }
      .linkcard:hover {
        transform: translateY(-2px);
      }

      .tag {
        display: inline-block;
        margin-top: 10px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--line);
        color: var(--muted);
        font-size: 0.8rem;
        background: rgba(255, 255, 255, 0.35);
        transition: background-color 900ms ease, border-color 900ms ease, color 900ms ease;
      }

      .footer {
        margin: 30px 0 10px;
      }

      .contactline {
        margin: 8px 0;
      }

      @media (max-width: 840px) {
        .metrics {
          grid-template-columns: 1fr;
        }
        .grid {
          grid-template-columns: 1fr;
        }
        .cards {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <header class="wrap header">
      <a class="brand" href="/">
        <span class="mark" aria-hidden="true">JW</span>
        <span style="font-weight: 700">Jack Wormgoor</span>
      </a>

      <nav class="nav" aria-label="Primary">
        <a href="#projects">Projects</a>
        <a href="#writing">Writing</a>
        <a href="#contact">Contact</a>
      </nav>
    </header>

    <main class="wrap">
      <section class="hero">
        <p class="kicker">jackwormgoor.com</p>
        <h1>Builder. Experimenter. Problem solver.</h1>
        <p class="lede">
          I build practical things and odd things — sometimes both at once. This is my corner of the internet for
          projects, notes, and whatever I’m testing lately.
        </p>

        <div class="cta">
          <a class="btn" href="#projects">View projects</a>
          <a class="btn ghost" href="#contact">Contact</a>
        </div>

        <div class="metrics" aria-label="Live dashboard">
          {metrics.map((m) => (
            <div class="metric" data-key={m.key}>
              <div class="label">{m.label}</div>
              <div class="value">{m.value}</div>
              <div class="hint">{m.hint}</div>
            </div>
          ))}
        </div>
      </section>

      <section class="grid">
        <article class="card">
          <h2>About</h2>
          <p>
            I like building systems that feel real — from workshop projects to software to field experiments. I’m into
            practical engineering, playful problem-solving, and documenting the process.
          </p>
          <p class="muted">Based in the UK. Usually covered in sawdust or tabs.</p>
        </article>

        <article class="card">
          <h2>Now</h2>
          <ul class="list">
            <li><strong>Current focus:</strong> a “living” personal site with live metrics.</li>
            <li><strong>Next:</strong> add a Projects index + 3 featured builds.</li>
            <li><strong>Ongoing:</strong> documenting experiments (and the failures).</li>
          </ul>
        </article>
      </section>

      <section id="projects" class="section">
        <div class="sectionhead">
          <h2>Selected projects</h2>
          <p class="muted">A few things I’ve built or am building. We’ll flesh these out next.</p>
        </div>

        <div class="cards">
          {projects.map((p) => (
            <a class="card linkcard" href="#">
              <h3>{p.title}</h3>
              <p class="muted">{p.desc}</p>
              <span class="tag">{p.tag}</span>
            </a>
          ))}
        </div>
      </section>

      <section id="writing" class="section">
        <div class="sectionhead">
          <h2>Writing & ideas</h2>
          <p class="muted">Short notes, longer posts, and occasionally a rant about glue.</p>
        </div>

        <div class="cards">
          {posts.map((p) => (
            <a class="card linkcard" href="#">
              <h3>{p.title}</h3>
              <p class="muted">{p.desc}</p>
              <span class="tag">{p.tag}</span>
            </a>
          ))}
        </div>
      </section>

      <section id="contact" class="section">
        <div class="sectionhead">
          <h2>Contact</h2>
          <p class="muted">Pick your weapon.</p>
        </div>

        <div class="cards" style="grid-template-columns: 1fr;">
          <div class="card">
            <p class="contactline"><strong>Email:</strong> <span class="muted">you@domain.com</span></p>
            <p class="contactline"><strong>GitHub:</strong> <span class="muted">github.com/JWormgoor</span></p>
            <p class="contactline"><strong>YouTube:</strong> <span class="muted">youtube.com/…</span></p>
          </div>
        </div>
      </section>

      <footer class="footer">
        <p class="muted">© {year} Jack Wormgoor. Built with Astro.</p>
      </footer>
    </main>

    <script>
      // Helpers
      const pad2 = (n) => String(n).padStart(2, "0");
      const fmtTime = (d) => `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;

      const getCard = (key) => document.querySelector(`.metric[data-key="${key}"]`);

      const setCard = (key, { value, hint }) => {
        const card = getCard(key);
        if (!card) return;
        if (value !== undefined) card.querySelector(".value").textContent = value;
        if (hint !== undefined) card.querySelector(".hint").textContent = hint;
      };

      // 1) Local time widget (no API)
      (() => {
        const tick = () => {
          const d = new Date();
          setCard("time", {
            value: d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" }),
            hint: d.toLocaleDateString([], { weekday: "short", day: "2-digit", month: "short" }),
          });
        };
        tick();
        setInterval(tick, 15000);
      })();

      // 2) Sunrise / Sunset + theme switching (Day / Golden / Night)
      async function fetchSunTimes(lat, lng) {
        const url = `https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lng}&formatted=0`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Sun API failed");
        const data = await res.json();
        if (data.status !== "OK") throw new Error("Sun API not OK");
        return {
          sunrise: new Date(data.results.sunrise),
          sunset: new Date(data.results.sunset),
        };
      }

      function applyThemeFromSun(sunrise, sunset) {
        const now = new Date();

        // Golden window: 30 minutes after sunrise, and 30 minutes before sunset
        const goldenMinutes = 30;
        const goldenMs = goldenMinutes * 60 * 1000;

        const goldenAfterSunriseStart = sunrise;
        const goldenAfterSunriseEnd = new Date(sunrise.getTime() + goldenMs);

        const goldenBeforeSunsetStart = new Date(sunset.getTime() - goldenMs);
        const goldenBeforeSunsetEnd = sunset;

        const isDay = now >= sunrise && now < sunset;
        const isGolden =
          (now >= goldenAfterSunriseStart && now <= goldenAfterSunriseEnd) ||
          (now >= goldenBeforeSunsetStart && now <= goldenBeforeSunsetEnd);

        let theme = "dark";
        if (isDay) theme = "light";
        if (isGolden) theme = "golden";
        if (!isDay) theme = "dark";

        document.documentElement.dataset.theme = theme;

        const label = theme === "light" ? "Day" : theme === "golden" ? "Golden" : "Night";
        setCard("mode", { value: label, hint: `Golden window: ±${goldenMinutes} mins` });
      }

      function scheduleNextSwitch(sunrise, sunset) {
        const now = new Date();
        const goldenMinutes = 30;
        const goldenMs = goldenMinutes * 60 * 1000;

        // We schedule the soonest upcoming boundary among:
        // sunrise, sunrise+golden, sunset-golden, sunset
        const boundaries = [
          sunrise,
          new Date(sunrise.getTime() + goldenMs),
          new Date(sunset.getTime() - goldenMs),
          sunset,
        ].filter((t) => t.getTime() > now.getTime());

        if (boundaries.length === 0) return;

        boundaries.sort((a, b) => a.getTime() - b.getTime());
        const next = boundaries[0];

        const ms = next.getTime() - now.getTime();
        setTimeout(() => {
          applyThemeFromSun(sunrise, sunset);
          // Re-schedule again after switching
          scheduleNextSwitch(sunrise, sunset);
        }, Math.max(5000, ms + 5000));
      }

      async function initSunAndTheme() {
        // Fallback location: Salisbury, UK
        const fallback = { lat: 51.0688, lng: -1.7945 };

        // Try browser geolocation (optional)
        const position = await new Promise((resolve) => {
          if (!navigator.geolocation) return resolve(null);
          navigator.geolocation.getCurrentPosition(
            (pos) => resolve(pos),
            () => resolve(null),
            { enableHighAccuracy: false, timeout: 4000, maximumAge: 3600000 }
          );
        });

        const lat = position?.coords?.latitude ?? fallback.lat;
        const lng = position?.coords?.longitude ?? fallback.lng;

        try {
          setCard("sun", { value: "Loading…", hint: "Fetching sunrise/sunset…" });

          const { sunrise, sunset } = await fetchSunTimes(lat, lng);

          setCard("sun", {
            value: `${fmtTime(sunrise)} ↑  ${fmtTime(sunset)} ↓`,
            hint: "Updates daily • based on your location",
          });

          applyThemeFromSun(sunrise, sunset);
          scheduleNextSwitch(sunrise, sunset);

          // Refresh every 4 hours (simple + reliable)
          setTimeout(() => initSunAndTheme(), 4 * 60 * 60 * 1000);
        } catch (e) {
          setCard("sun", { value: "Unavailable", hint: "Couldn’t fetch sun times" });
        }
      }

      initSunAndTheme();
    </script>
  </body>
</html>
